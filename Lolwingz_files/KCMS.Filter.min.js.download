KCMS.registerNamespace("KCMS.Filter"),KCMS.Filter=function(b){return{init:function(t,e,i){function r(t){for(var e=(t=(t||location.search.substring(1)).toLowerCase()).split("&"),i={},s=0;s<e.length;s++)if(""!=e[s]){var a=e[s].split("=");i[decodeURI(a[0])]=decodeURI(a[1])}return i}function s(t,e){var i=t.split("?");t=i[0];var s=r(1<i.length?i[1]:"");for(var a in e)e.hasOwnProperty(a)&&(s[a]=e[a].join(","));var l="";for(var a in s)s.hasOwnProperty(a)&&s[a]&&(l+="&"+encodeURI(a)+"="+encodeURI(s[a]));return l?t+"?"+l.substring(1):t}var a=!1;function l(){if(!a)return!1;var i={};b(".filter .filter-group",o).each(function(){i[b(this).data("group").toLowerCase()]=[]}),b(".filter .option-item .checkbox.active",o).each(function(){var t=b(this).closest(".filter-group").data("group").toLowerCase(),e=b(this).closest("li").data("filtervalue").toString();i[t].push(e.toLowerCase())});var t=s(location.href.split("#")[0],i);history&&history.pushState&&history.pushState({title:document.title},document.title,t)}var o=b(t),n=b(e),c=n.closest("section").find(".item-holder");function d(){var s={};b("li.l-flexTiles__item",n.closest(".section-product_gallery,.s-galleryNavigation")).each(function(){for(var t=(b(this).data("filtervalue")||"").toString().split(","),e=0;e<t.length;e++){var i=t[e];s.hasOwnProperty(i)?s[i]++:s[i]=1}}),b(".filter .option-item>ul>li>ol>li",o).each(function(){b(this).removeClass("disabled");var t=b(".checkbox",this).data("target"),e=s[t]||0;b(".count",this).text("("+e+")"),0==e&&b(this).addClass("disabled")})}function h(){var t=b(".filter-results>ul",o);0===t.children().size()?t.closest(".selected-filters").addClass("hidden"):t.closest(".selected-filters").removeClass("hidden"),c.children().appendTo(n);var e=b(">li",n),i={};t.children().each(function(){i[b(this).data("group")]||(i[b(this).data("group")]=[]),i[b(this).data("group")].push(b(this).data("target"))}),e.removeClass("hidden"),0<t.children().length&&e.each(function(){var s=(b(this).attr("data-filtervalue")||"").split(","),a=!0;b.each(i,function(t,e){var i=!1;b.each(e,function(t,e){!i&&0<=s.indexOf(e.toString())&&(i=!0)}),i||(a=!1)}),a||b(this).addClass("hidden")}),b(">li.hidden",n).appendTo(c);var s=b(".sort .option-item>ul>li>ol>li.selected",o);v(s.data("sort"),s.data("desc"));var a=b(">li:visible",n);0==a.size()?n.closest("section").find(".no-data").removeClass("hidden"):n.closest("section").find(".no-data").addClass("hidden");var l=a.size(),r=b(".result-count",o);0<r.length&&(1<l?r.html(r.data("multi").replace(/\{\d+\}/,l)):r.html(r.data("single").replace(/\{\d+\}/,l))),2<l?n.removeClass("minimal"):n.addClass("minimal"),d(),window.Rexus&&window.Rexus.flexTiles&&window.Rexus.flexTiles.update(),n.closest("section").find(".gallery-loadmore").trigger("reset")}function u(){var t=b(".filter .option-item>ul",o),e=t.width();if(0<e){var i=60;b(">li:not(.more-less):not(.clear-filters)",t).each(function(){i+=b(this).outerWidth()+10,e<i&&b(this).addClass("hidden")}),i<e&&b(">li.more-less",t).addClass("hidden")}}function v(i,s){var t=b(">li",n),e=t.not(".hidden").length;t=_.sortBy(t,function(t){return b(t).data("name")}),t=_.sortBy(t,function(t){return b(".btn.btn-medium",t).data("priority")||4}),t=_.sortBy(t,function(t){var e=b(t).data(i);return"price"==i&&(e="x"!=e?Number(e):s?-9999999:9999999),e}),s&&(t=t.reverse()),b(n).empty().append(t),window.Rexus&&window.Rexus.flexTiles&&window.Rexus.flexTiles.update(),b(t).addClass("hidden");for(var a=0;a<e;a++)b(t[a]).removeClass("hidden")}b(o).on("click",".conditions .sort",function(){if(b(window).width()<500)return b(this).hasClass("active")?(b(this).removeClass("active"),b(this).siblings(".filter").removeClass("inactive")):(b(this).removeClass("inactive").addClass("active"),b(this).siblings(".filter").removeClass("active").addClass("inactive")),!1}),b(o).on("click",".conditions .filter",function(){if(b(window).width()<500)return b(this).hasClass("active")?(b(this).removeClass("active"),b(this).siblings(".sort").removeClass("inactive")):(b(this).removeClass("inactive").addClass("active"),b(this).siblings(".sort").removeClass("active").addClass("inactive"),b(".filter-group",this).addClass("active")),!1}),b(".option-item>ul>li:not(.more-less):not(.clear-filters)",o).click(function(){return 500<=b(window).width()&&b(this).siblings().not(".more-less").not(".clear-filters").removeClass("active"),b(this).toggleClass("active"),!1}),b(".filter .option-item>ul>li>ol>li",o).click(function(){if(b(this).hasClass("disabled"))return!1;var t=b(".checkbox",this);t.data("target")||t.data("target",(new Date).valueOf());var e=b(".filter-results>ul",o);if(t.hasClass("active"))e.children().each(function(){b(this).data("target")===t.data("target")&&b(this).remove()});else{var i=b("<li>"+b(".text",this).text()+'<span class="close">x</span></li>');i.data("target",t.data("target")),i.data("group",t.closest(".filter-group").data("filterid")),e.append(i)}return h(),t.toggleClass("active"),l(),!1}),b(".filter .option-item>ul>li.more-less>a",o).click(function(){return b(this).parent().toggleClass("active"),b(this).hasClass("expand")?b(this).closest("ul").find(".hidden").removeClass("hidden"):b(this).hasClass("shrink")&&u(),!1}),u(),b(".sort .option-item>ul>li>ol>li",o).click(function(){if(!b(this).hasClass("selected")){b(this).addClass("selected"),b(this).siblings().removeClass("selected").find(".radio").removeClass("active"),b(this).siblings().each(function(t){t%2==0?b(this).addClass("even"):b(this).removeClass("even")}),b(".radio",this).addClass("active"),b(this).parent().closest("li").find(".option-text>span").html(b(this).text()),b(this).closest(".sort").trigger("click"),v(b(this).data("sort"),b(this).data("desc"));var t=s(location.href.split("#")[0],{sortby:[b(this).data("orderby")]});return history&&history.pushState&&history.pushState({title:document.title},document.title,t),window.Rexus&&window.Rexus.flexTiles&&window.Rexus.flexTiles.update(),!1}}).each(function(t){t%2==0?b(this).addClass("even"):b(this).removeClass("even")}),b(o).on("click",".filter-results .close",function(){var t=b(this).parent(),e=t.data("target");b(".filter .checkbox.active",o).each(function(){b(this).data("target")===e&&b(this).removeClass("active")}),t.remove(),h(),l()}),b(o).on("click",".clear-filters",function(){b(".filter-results>ul",o).empty(),b(".filter .checkbox.active",o).removeClass("active"),h(),l()}),b(n).on("click",".btn-buy_from",function(){return b(">li.active",n).removeClass("active"),b(this).closest("li").addClass("active"),!1}),b(n).on("click",".partner-close",function(){return b(this).closest("li").removeClass("active"),!1}),b(document).on("click",function(){b(".active:not(.radio):not(.checkbox):not(.more-less):not(.clear-filters)",o).removeClass("active"),b(".inactive",o).removeClass("inactive")});var f=r(),p={};for(var m in f)f.hasOwnProperty(m)&&(p[m]=f[m].split(","));var C=b(".filter-group",o),g=!1;for(var m in p)if(p.hasOwnProperty(m)){var w=p[m];C.each(function(){if(b(this).data("group").toLowerCase()==m)for(var t=0;t<w.length;t++){var e=w[t];b(this).find("ol>li").each(function(){b(this).data("filtervalue").toLowerCase()==e&&(b(this).click(),g=!0)})}})}a=!0,g||d(),p.sortby&&b(".sort .option-item>ul>li>ol>li."+p.sortby,o).each(function(){b(this).addClass("selected"),b(this).siblings().removeClass("selected").find(".radio").removeClass("active"),b(".radio",this).addClass("active"),b(this).parent().closest("li").find(".option-text>span").html(b(this).text())});var x=b(".sort .option-item>ul>li>ol>li.selected",o);v(x.data("sort"),x.data("desc")),window.Rexus&&window.Rexus.flexTiles&&window.Rexus.flexTiles.update();var y=[];b("li[data-clientgetprice='true']",n).each(function(t){var e=b(this).data("partnumber");y.push(e)}),function(t){if(t&&0<t.length){var e=JSON.stringify({partnumbers:t});b.ajax({url:i.getProductPriceUrl,type:"post",contentType:"application/json",data:e,success:function(t){t&&0<t.length&&t.forEach(function(t){var e=b("li[data-partnumber='"+t.PartNumber+"']",n);e.attr("data-price",t.NormalPrice),b(".regular-sale",e).text(t.OriginalPrice),b(".cost-sale",e).html(t.DisplayPrice),b('.f-quantity__input input[name="ecommerceQuantity"]',e).data("max",t.AddToCartExperience.CallToAction.QantityLimit),b(".f-quantity__input .tooltip-group .tooltip__message>span",e).text(t.AddToCartExperience.CallToAction.QantityLimitMessage)})}})}}(y)}}};