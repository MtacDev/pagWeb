KCMS.registerNamespace("KCMS.Tracking");KCMS.Tracking=function(){return{TrackingData:{},isMobilePlus:!1,InitialTrackingData:function(n,t,i){KCMS.Tracking.isMobilePlus=typeof i!="undefined"&&i;var r=[];$.get(n+"?path="+encodeURIComponent(t),function(n){n&&(KCMS.Tracking.TrackingData=n,$.each(n,function(n,t){var i=KCMS.Tracking.GetSelector(t.TargetID,t.TargetClass,t.TargetHref);i&&!$(i).is(".no-manual-tracking")&&r.push(i)}),KCMS.Tracking.BindLinkTracking(r.join(",")))},"json");this.BindConstantLinkTracking()},BindLinkTracking:function(n){if(n){$(n).addClass("hasTracking");$.each(KCMS.Tracking.TrackingData,function(n,t){var i=KCMS.Tracking.GetSelector(t.TargetID,t.TargetClass,t.TargetHref);$(i).not(".no-manual-tracking").each(function(){var n=$(this);n.attr("data-track-category",t.Category).attr("data-track-action",t.TrackAction).attr("data-track-label",t.Label?t.Label:n.data("track-label")).attr("data-track-value",t.Value)})});$(document).on("click",n,function(){var n=$(this);KCMS.Tracking.sendEventTrackingData(n)})}},BindConstantLinkTracking:function(){$(document).on("click","a.tracked",function(){var n=$(this);KCMS.Tracking.sendEventTrackingData(n)})},sendEventTrackingData:function(n){if(typeof n!="undefined"&&n!=null){var i=n.data("track-category"),r=n.data("track-action"),u=n.data("track-label"),t=n.data("track-value"),f=n.data("track-noninteraction");i&&r&&t||$.each(KCMS.Tracking.TrackingData,function(u,f){var e=KCMS.Tracking.GetSelector(f.TargetID,f.TargetClass,f.TargetHref);if(n.is(e)&&!n.is(".no-manual-tracking"))return i=f.Category,r=f.TrackAction,t=f.Value,!1});i||(i="");r||(r="");u||(u="");t&&t%1==0||(t=0);typeof ga!="undefined"&&ga("send",{hitType:"event",eventCategory:i,eventAction:r,eventLabel:u,eventValue:t,nonInteraction:f})}},GetSelector:function(n,t,i){var u="",r;return n?u="#"+$.trim(n):t?(r="."+$.trim(t).replace(/\s+/g,"."),r.lastIndexOf(".")==r.length-1&&(r=r.substring(0,r.length-1)),r===".arrow"&&(r="a"+r),u=r):i&&(u="a[href='"+$.trim(i)+"']"),u},InitTrackingEdit:function(){$("#toggleTrackingBorder").click(KCMS.Tracking.ToggleTrackingTool);$("#btnInvalidTracking").click(function(){var n=[];$.each(KCMS.Tracking.TrackingData,function(t,i){var r=KCMS.Tracking.GetSelector(i.TargetID,i.TargetClass,i.TargetHref);$(r).length==0&&n.push(i.TrackingID)});$.fancybox({type:"iframe",width:1e3,height:510,centerOnScroll:!0,hideOnOverlayClick:!1,href:"/Admin/AnalyticsTracking/Invalid?InvalidIds="+n.join(",")})});$("#DesignTracking").fancybox({type:"iframe",width:650,height:660,centerOnScroll:!0,hideOnOverlayClick:!1,onClosed:function(n){if(n){var t=$(KCMS.Tracking.GetSelector(n.TargetID,n.TargetClass,n.TargetHref));n.Active?t.addClass("hasTracking"):t.removeClass("hasTracking")}}})},ToggleTrackingTool:function(){$(this).prop("checked")?$("a:not(.widget-edit,.dropdown-toggle,.widget-delete,#fancybox-close,.popover-close,.untrackable,.tracked),.Trackable").addClass("TrackingBorder").append($('<i class="icon-edit" title="Edit Tracking"><\/i>').click(KCMS.Tracking.EditTrackingClick)):$("a:not(.widget-edit,.dropdown-toggle,.widget-delete,#fancybox-close,.popover-close,.untrackable,.tracked),.Trackable").removeClass("TrackingBorder").children("i.icon-edit").remove()},EditTrackingClick:function(){var t,n,e;KCMS.Tracking.ClearRedBackGound();var i=$("#DesignTracking"),r=$.trim($(this).parent().attr("id")),u=$.trim($("<a>").addClass($(this).parent().attr("class")).removeClass("TrackingBorder").removeClass("hasTracking").removeClass("Trackable").removeClass("hover").attr("class")),f=$.trim($(this).parent().attr("href")),o=!1;if($.trim($(this).parent().data("track-label"))&&(o=!0),t=i.data("href"),t+="&hasDataLabel="+o,r?t+="&targetId="+encodeURIComponent(r):u?t+="&targetClass="+encodeURIComponent(u):f&&(t+="&targetHref="+encodeURIComponent(f)),n=KCMS.Tracking.GetSelector(r,u,f),n&&(t+="&selector="+encodeURIComponent(n)),!n)return alert("Can't find any selector,please add an unique id in the tag."),!1;if(e=$(n).size(),e>1){$(n).addClass("redBorder");$(document).on("click",KCMS.Tracking.ClearRedBackGound);if(!confirm('Find more than one tag with the selector "'+n+'",are you sure to continue?'))return!1}return($(document).off("click",KCMS.Tracking.ClearRedBackGound),KCMS.Tracking.ClearRedBackGound(),e==0)?(alert("Can't find the tag with the selector '"+n+"' ."),!1):(i.text(n),i.attr("href",t),i.click(),!1)},ClearRedBackGound:function(){$(".redBorder").removeClass("redBorder")}}}();